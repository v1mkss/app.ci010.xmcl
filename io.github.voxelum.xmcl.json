{
  "app-id": "io.github.voxelum.xmcl",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "23.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "xmcl-wrapper.sh",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--device=dri",
    "--filesystem=home",
    "--filesystem=xdg-run/pipewire-0",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.freedesktop.secrets",
    "--talk-name=com.discordapp.Discord",
    "--own-name=org.discordapp.Discord.discordrpc",
    "--system-talk-name=org.freedesktop.DBus",
    "--talk-name=org.kde.StatusNotifierWatcher",
    "--env=ELECTRON_ENABLE_STACK_DUMPING=false",
    "--env=ELECTRON_ENABLE_LOGGING=false",
    "--device=all"
  ],
  "modules": [
    {
      "name": "mesa-utils",
      "buildsystem": "simple",
      "build-commands": ["cp /usr/bin/glxinfo /app/bin/ || true"],
      "sources": []
    },
    {
      "name": "xmcl",
      "buildsystem": "simple",
      "build-commands": [
        "mkdir -p /app/bin",
        "mkdir -p /app/opt/xmcl",
        "mkdir -p /app/share/applications",
        "mkdir -p /app/share/icons/hicolor",
        "mkdir -p /app/share/fontconfig/conf.d",
        "tar xf xmcl-0.50.5-x64.tar.xz -C /app/opt/xmcl --strip-components=1",
        "chmod +x /app/opt/xmcl/xmcl",
        "cp fonts.conf /app/share/fontconfig/conf.d/10-xmcl-fonts.conf || true",
        "mkdir -p /app/share/icons/hicolor/512x512/apps",
        "cp io.github.voxelum.xmcl.png /app/share/icons/hicolor/512x512/apps/io.github.voxelum.xmcl.png",
        "chmod 644 /app/share/icons/hicolor/512x512/apps/io.github.voxelum.xmcl.png",
        "cp xmcl.desktop /app/share/applications/io.github.voxelum.xmcl.desktop",
        "chmod 644 /app/share/applications/io.github.voxelum.xmcl.desktop",
        "sed -i 's|Exec=xmcl|Exec=/app/bin/xmcl-wrapper.sh|g' /app/share/applications/io.github.voxelum.xmcl.desktop",
        "sed -i 's|Icon=xmcl|Icon=io.github.voxelum.xmcl|g' /app/share/applications/io.github.voxelum.xmcl.desktop",
        "printf '#!/bin/sh\\nexport LD_LIBRARY_PATH=/app/opt/xmcl:$LD_LIBRARY_PATH\\nexport FONTCONFIG_PATH=/app/share/fontconfig\\nexport FONTCONFIG_FILE=/app/share/fontconfig/conf.d/10-xmcl-fonts.conf\\nexport GTK_USE_PORTAL=1\\nexport APPIMAGE=1\\nunset JAVA_HOME\\nexec /app/opt/xmcl/xmcl --enable-webrtc-pipewire-capturer --no-sandbox \"$@\"\\n' > /app/bin/xmcl-wrapper.sh",
        "chmod +x /app/bin/xmcl-wrapper.sh"
      ],
      "sources": [
        {
          "type": "file",
          "url": "https://github.com/Voxelum/x-minecraft-launcher/releases/download/v0.50.5/xmcl-0.50.5-x64.tar.xz",
          "sha256": "538478f9f59a24acdd41ddb6d8612c5daa7c2985b4e06709ea7b67eb879dc27b"
        },
        {
          "type": "file",
          "path": "assets/fonts.conf"
        },
        {
          "type": "file",
          "path": "assets/icons/hicolor/512x512/apps/xmcl.png",
          "dest-filename": "io.github.voxelum.xmcl.png"
        },
        {
          "type": "file",
          "path": "assets/xmcl.desktop",
          "dest-filename": "xmcl.desktop"
        }
      ]
    }
  ],
  "cleanup": ["/include", "/lib/pkgconfig"]
}
